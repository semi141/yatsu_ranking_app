# README

奴ランキング見る奴 - YouTube視聴傾向を可視化する視聴記録アプリ

### 1. サービス概要

「好き」を可視化し、熱狂的なファンの視聴トレンドを共有する**ジャルジャル専門視聴記録アプリ**

### 2. サービス画像

#### ランキング画面（全体ランキング）
![ランキング画面のスクリーンショット](https://raw.githubusercontent.com/semi141/yatsu_ranking_app/main/images/ランキングページ.PNG)

#### 動画詳細画面
![動画詳細画面のスクリーンショット](https://raw.githubusercontent.com/semi141/yatsu_ranking_app/main/images/動画詳細ページ.PNG)

#### 検索結果画面
![検索結果画面のスクリーンショット](https://raw.githubusercontent.com/semi141/yatsu_ranking_app/main/images/検索結果ページ.PNG)

### 3. サービスのURL
**[https://yatsu-ranking-viewer-5fd11a800c35.herokuapp.com/](https://yatsu-ranking-viewer-5fd11a800c35.herokuapp.com/)**

#### Chrome拡張機能のリポジトリ（視聴記録連携用）
本アプリのコア機能である視聴記録の取得に使用するChrome拡張機能のソースコードとインストール手順はこちらをご確認ください。

[Chrome拡張機能ソースコード](https://github.com/semi141/yatsu_ranking_app/tree/main/chrome_extension)

### 4. サービスの詳細・概要

「奴ランキング見る奴」は、YouTubeチャンネル「ジャルジャルタワー」と「ジャルジャルアイランド」の中でも、**タイトルに「奴」を含む動画**の視聴記録に特化したWebアプリケーションです。

ユーザーは専用の**Chrome拡張機能**を導入することで、対象動画を視聴した際に、アプリ内に視聴回数を自動で記録できます。

記録されたデータに基づき、「**自分だけの視聴回数ランキング**」や「**ユーザー全体の視聴トレンドランキング**」を、期間やチャンネル（タワー/アイランド）で絞り込んで確認できます。これは、単なる視聴記録ではなく、**「推し」への熱量をデータで可視化し共有する**ことを目的としています。

### 5. 開発背景

熱心なファンとして、自分がどの「奴」動画を最も見ているのか、また世間のファンがどの動画を繰り返し見ているのかという**マニアックな視聴傾向を知りたい**という思いが一番のきっかけです。

当初はYouTubeの公式APIを利用して視聴履歴を取得する予定でしたが、開発中にAPIの制限や仕様変更という壁に直面しました。そこで、**「課題を乗り越えてでもコア機能を実現する」**という強い思いから、Chrome拡張機能と独自のAPI連携という、より高度で安定した技術的アプローチを採用し、このアプリを完成させました。

**【開発期間】**

* **全体期間:** 約1ヶ月（企画〜デプロイまで）
* **特記事項:** 最初の1週間で、当初の設計の問題点に気づき、**全てを一度破棄して再設計**を行いました。この判断により、その後の3週間で一気に開発を進め、**堅牢性と拡張性の高いシステム**を実現しています。

### 6. 機能

#### ランキング機能（ホーム画面）
* **自分/全体ランキング切替:** ユーザーのログイン状態に合わせてデフォルトのタブを切り替え（ログイン時: 自分、ログアウト時: 全体）。
* **絞り込み:** 期間（全期間、週、月）やチャンネル（ジャルジャルタワー/アイランド）でランキングをフィルタリング。
* **ページネーション:** 効率的なページネーションを実装し、大量のデータでも快適に閲覧できるよう対応。

#### 動画詳細・コミュニケーション
* **視聴記録の自動更新:** Chrome拡張機能からの記録に加え、**アプリ内の埋め込みプレイヤーでの再生時**にも、重複防止ロジックをもって視聴回数を自動更新。
* **コメント機能:** 動画に対してコメントの投稿・編集・削除（CRUD）が可能。
* **タグ機能:** 動画にタグを付与し、特定のテーマで動画を絞り込み検索可能。

#### マイページ・認証
* **認証機能:** Google OAuthによる認証と、体験用のゲストログインに対応。
* **APIトークン管理:** Chrome拡張機能連携に必要な**専用APIトークン**の発行・再生成機能を実装。

#### その他・利便性・UI/UX
* **使い方ガイド/免責事項:** 初めてのユーザー向けに、Chrome拡張機能との連携方法や、アプリの利用手順を詳しく解説した専用ページを設置。ページ内で非公式である旨の免責事項も明確に記述し、信頼性を確保。
* **日本語メッセージ:** DeviseのFlashメッセージを日本語化し、ユーザー体験を向上。
* **ヘッダーデザイン:** アクションボタン（ログイン/マイページ/ログアウト）とナビゲーションボタンで配色にメリハリをつけ、視認性を最適化。

### 7. 主な使用技術と技術的な工夫

#### フロントエンド
* HTML / CSS / JavaScript
* Bootstrap (スタイリング)
* YouTube IFrame Player API

#### バックエンド
* Ruby (3.3.3)
* Ruby on Rails (7.2.3)
* PostgreSQL (本番) / SQLite3 (開発)

#### インフラ・開発環境
* Heroku (デプロイ)
* Git / GitHub (バージョン管理)

#### 技術的な工夫・挑戦点

本アプリでは、YouTube公式APIの利用制限を回避するため、**独自のChrome拡張機能とAPIトークン認証を組み合わせた外部連携システム**を構築しています。これにより、ユーザーの視聴記録を安全かつ確実に受信できる基盤を確立しました。

* **データベース設計:** 視聴記録（`Watch`）を独立させ、**高度なSQLサブクエリ**を用いてランキングを効率的に集計しています。
* **UI/UXの改善:** Deviseメッセージの国際化（I18n）による**日本語対応**、ログイン/ログアウトなどの機能に応じた**ヘッダーUIの配色**、そして誤操作を防ぐ独自の**タグ編集モード**を実装し、ユーザー体験を向上させています。
* **堅牢性の確保:** 動画再生時の**カウント重複防止ロジック**や、Minitestによる機能テストの保証、さらには実装途中で**RSpecからMinitestへの移行**を行うことで、システムの安定性を担保しています。

### 8. ER図

現在のアプリのデータ構造（User, Video, Watch, Post, Tagging, Tag）は以下の通りです。

```text
┌─────────────────┐       ┌──────────────────┐       ┌─────────────────┐
│       User      │<-----*|       Watch      |*----->|      Video      |
├─────────────────┤       ├──────────────────┤       ├─────────────────┤
│ id: integer     │       │ id: integer      │       │ id: integer     │
│ api_token: string(UNQ)  │ user_id: integer   │       │ youtube_id: string(UNQ) │
│ email: string   │       │ video_id: integer  │       │ title: string     │
│ created_at: time│       │ watched_count: integer │   │ channel_id: string │
└─────────────────┘       │ created_at: time │       └─────────────────┘
          *|              └──────────────────┘                 |*
           |                                                   |
           |*------>┌──────────────────┐<-----*|
           |       │       Post       │                       |
           +------>├──────────────────┤                       +----->┌─────────────────┐
                   │ id: integer      │                             │      Tagging    │
                   │ user_id: integer │                             ├─────────────────┤
                   │ video_id: integer│                             │ video_id: integer │
                   │ content: text    │                             │ tag_id: integer   │
                   │ created_at: time │                             └─────────────────┘
                   └──────────────────┘                                      |
                                                                             |*
                                                                             ↓
                                                                     ┌─────────────────┐
                                                                     │       Tag       │
                                                                     ├─────────────────┤
                                                                     │ name: string(UNQ)│
                                                                     └─────────────────┘
```

### 9. 今後の展望

* **UI/UXの改善:** モバイルレスポンシブ対応を完了させ、ユーザーインターフェースを洗練させる。
* **分析機能の強化:** ユーザーの視聴傾向をグラフなどで可視化する統計ページを追加。
* **コミュニティ機能の拡充:** ユーザー同士でランキングや視聴記録をシェアする機能を追加。