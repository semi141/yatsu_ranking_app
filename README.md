# README

奴ランキング見る奴 - YouTube視聴傾向を可視化する視聴記録アプリ

### 1. サービス概要

「好き」を可視化し、熱狂的なファンの視聴トレンドを共有する**ジャルジャル専門視聴記録アプリ**

### 2. サービス画像

#### ランキング画面
![ランキング画面のスクリーンショット]
#### 動画詳細画面
![動画詳細画面のスクリーンショット]
### 3. サービスのURL
**[https://yatsu-ranking-viewer-5fd11a800c35.herokuapp.com/](https://yatsu-ranking-viewer-5fd11a800c35.herokuapp.com/)**

### 4. サービスの詳細・概要
...（省略。変更なし）...
**「推し」への熱量をデータで可視化し共有する**ことを目的としています。

### 5. 開発背景
...（省略。変更なし）...
**堅牢性と拡張性の高いシステム**を実現しています。

**【開発期間】**

* **全体期間:** 約1ヶ月（企画〜デプロイまで）
* **特記事項:** 最初の1週間で、当初の設計の問題点に気づき、**全てを一度破棄して再設計**を行いました。この判断により、その後の3週間で一気に開発を進め、**堅牢性と拡張性の高いシステム**を実現しています。

### 6. 主な機能

#### ランキング機能（ホーム画面）
* **自分/全体ランキング切替:** ユーザーのログイン状態に合わせてデフォルトのタブを切り替え（ログイン時: 自分、ログアウト時: 全体）。
* **絞り込み:** 期間（全期間、週、月）やチャンネル（ジャルジャルタワー/アイランド）でランキングをフィルタリング。
* **ページネーション:** 効率的なページネーションを実装し、大量のデータでも快適に閲覧できるよう対応。

#### 動画詳細・コミュニケーション
* **視聴記録の自動更新:** Chrome拡張機能からの記録に加え、**アプリ内の埋め込みプレイヤーでの再生時**にも、重複防止ロジックをもって視聴回数を自動更新。
* **コメント機能:** 動画に対してコメントの投稿・編集・削除（CRUD）が可能。
* **タグ機能:** 動画にタグを付与し、特定のテーマで動画を絞り込み検索可能。

#### マイページ・認証
* **認証機能:** Google OAuthによる認証と、体験用のゲストログインに対応。
* **APIトークン管理:** Chrome拡張機能連携に必要な**専用APIトークン**の発行・再生成機能を実装。

#### **その他・利便性・UI/UX**
* **使い方ガイド/免責事項:** 初めてのユーザー向けに、Chrome拡張機能との連携方法や、アプリの利用手順を詳しく解説した専用ページを設置。ページ内で**非公式である旨の免責事項**も明確に記述し、**信頼性**を確保。
* **日本語メッセージ:** DeviseのFlashメッセージを**日本語化**し、ユーザー体験を向上。
* **ヘッダーデザイン:** アクションボタン（ログイン/マイページ/ログアウト）とナビゲーションボタンで配色にメリハリをつけ、**視認性**を最適化。

### 7. 主な使用技術と技術的な工夫 💡

| カテゴリ | 技術名 | 特筆すべき工夫・挑戦点 |
| :--- | :--- | :--- |
| **バックエンド** | Ruby (3.3.3), Ruby on Rails (7.2.3) | **高度なSQLサブクエリ**を使用し、視聴記録テーブル（`Watch`）を結合してランキングを効率的に集計。 |
| **外部連携** | **Chrome拡張機能 (JavaScript)**, **独自API** | YouTube公式API廃止に対応し、専用のAPIトークン認証（`User.api_token`）で安全かつ確実に視聴記録を受信。 |
| **データベース** | PostgreSQL (本番), SQLite3 (開発) | **`Watch`モデル**を独立させ、視聴記録とコメント（`Post`）のデータを分離することで集計の拡張性を確保。 |
| **タグ機能** | `acts-as-taggable-on` | **タグ編集モード**という独自のJavaScript/UIを実装し、誤操作を防ぎつつ柔軟なタグ付け・削除を実現。 |
| **UI/UX** | Bootstrap, YouTube IFrame Player API | **自前で`OFFSET`/`LIMIT`を制御**するページネーションを実装。動画詳細ページでの再生時カウント重複防止ロジックも実装。**ヘッダーUIを機能に応じて配色し、視認性を高めた。** |
| **テスト** | **Minitest** | 当初予定していたRSpecから、環境と要件に合わせて**Minitest**に移行し、機能の動作保証を担保。 |
| **認証/I18n** | Devise, `omniauth-google-oauth2` | Google OAuthによる認証基盤を構築し、ゲストログイン機能を実装。**メッセージの国際化（I18n）対応により、ユーザーへのメッセージを日本語化。** |

### 8. ER図

┌─────────────────┐       ┌──────────────────┐       ┌─────────────────┐
│      User       │<-----*|       Watch        |*----->|      Video      |
├─────────────────┤       ├──────────────────┤       ├─────────────────┤
│ id: integer     │       │ id: integer      │       │ id: integer     │
│ api_token: string(UNQ)  │ user_id: integer   │       │ youtube_id: string(UNQ) │
│ email: string   │       │ video_id: integer  │       │ title: string   │
│ created_at: time│       │ watched_count: integer │   │ channel_id: string │
└─────────────────┘       │ created_at: time │       └─────────────────┘
         *|                └──────────────────┘                 |*
          |                                                     |
          |*------>┌──────────────────┐<-----*|
          |       │       Post       │                        |
          +------>├──────────────────┤                        +----->┌─────────────────┐
                  │ id: integer      │                              │     Tagging     │
                  │ user_id: integer │                              ├─────────────────┤
                  │ video_id: integer│                              │ video_id: integer │
                  │ content: text    │                              │ tag_id: integer │
                  │ created_at: time │                              └─────────────────┘
                  └──────────────────┘                                        |
                                                                              |*
                                                                              ↓
                                                                  ┌─────────────────┐
                                                                  │       Tag       │
                                                                  ├─────────────────┤
                                                                  │ name: string(UNQ)│
                                                                  └─────────────────┘

### 9. 今後の展望

* **UI/UXの改善:** モバイルレスポンシブ対応を完了させ、ユーザーインターフェースを洗練させる。
* **分析機能の強化:** ユーザーの視聴傾向をグラフなどで可視化する統計ページを追加。
* **コミュニティ機能の拡充:** ユーザー同士でランキングや視聴記録をシェアする機能を追加。