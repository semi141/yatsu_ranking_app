<div class="container mt-5">
  <h1 class="mb-4">マイページ</h1>
  <p class="lead">ようこそ、<strong><%= current_user.name %></strong>さん！</p>

  <div class="card mt-5 border-success">
    <div class="card-header bg-success text-white">
      <h3 class="mb-0">拡張機能の利用開始手順</h3>
    </div>
    <div class="card-body">
      <p class="mb-3">「奴ランキング見る奴」拡張機能を有効にするには、以下の<strong>2つのステップ</strong>を実行してください。</p>

      <div class="alert alert-info py-3" role="alert">
        <h4 class="alert-heading">ステップ 1: 拡張機能のインストール（デベロッパーモードで手動読み込み）</h4>
        <ol class="list-group list-group-numbered mb-3">
          <li class="list-group-item">
            以下のボタンから<strong>拡張機能のファイル一式</strong>をZIPファイルでダウンロードします。
            <p class="mt-2 text-center">
              <%= link_to "💾 拡張機能ZIPファイルをダウンロード", "https://github.com/semi141/yatsu-ranking-extension/archive/refs/heads/master.zip", class: "btn btn-info btn-lg text-white font-weight-bold", target: "_blank" %>
            </p>
          </li>
          <li class="list-group-item">
            ダウンロードしたZIPファイルを展開すると、<strong>`yatsu-ranking-extension-master`</strong>という名前のフォルダが作成されます。このフォルダをデスクトップなど分かりやすい場所に移動させます。
          </li>
          <li class="list-group-item">
            Chromeブラウザでアドレスバーに <code class="text-danger">chrome://extensions</code> と入力し、拡張機能管理ページを開きます。右上の<strong>「デベロッパーモード」</strong>をオンにします。
          </li>
          <li class="list-group-item">
            <strong>「パッケージ化されていない拡張機能を読み込む」</strong>ボタンを押し、先ほど移動させた<strong>`yatsu-ranking-extension-master`フォルダ</strong>を選択します。
            <div class="mt-3 text-center">
              <img src="/images/step1_chrome_ext.jpg" class="img-fluid border rounded shadow-sm" alt="Chrome拡張機能のデベロッパーモードと読み込みボタンの操作">
            </div>
          </li>
        </ol>
      </div>

      <div class="alert alert-info py-3 mt-5" role="alert">
        <h4 class="alert-heading">ステップ 2 の準備: トークンのコピー</h4>
        <p>以下の<strong>専用APIトークン</strong>をコピーし、<strong>ステップ 3</strong> で使用します。</p>

        <div class="alert alert-warning">
          <strong>⚠ 注意：このトークンは絶対に他人に見せないで！漏れると他人に成り済まされちゃうよ！</strong>
        </div>

        <pre class="bg-light p-4 rounded" style="font-size:1.1em; overflow-x:auto;">
<%= current_user.api_token %>
        </pre>

        <%= button_to "トークンを再生成する（古いトークンは無効になります）", 
            regenerate_token_users_path, 
            method: :post,
            data: { confirm: "本当に再生成しますか？\n拡張機能の設定も必ず更新してね！" },
            class: "btn btn-danger btn-lg mt-3" %>
      </div>
      
      <div class="alert alert-info py-3 mt-5" role="alert">
        <h4 class="alert-heading">ステップ 3: 拡張機能の設定画面への入力</h4>
        <ol class="list-group list-group-numbered">
          <li class="list-group-item">👆 上記の<strong>ステップ 2 でコピーしたトークン</strong>を用意します。
            <div class="mt-3 text-center">
              <img src="/images/step3_token_menu.jpg" class="img-fluid border rounded shadow-sm" alt="パズルのピースアイコンをクリックして拡張機能メニューを開く">
            </div>
          </li>
          <li class="list-group-item">
            お使いのChromeブラウザで、アドレスバーの右側にある
            <strong>パズルのピースの形をしたアイコン（拡張機能メニュー）</strong>
            をクリックし、表示された一覧から
            <strong>「奴ランキング見る奴」拡張機能のアイコン</strong>
            を探してクリックします。
            <div class="mt-3 text-center">
              <img src="/images/step3_token_click.jpg" class="img-fluid border rounded shadow-sm" alt="拡張機能メニューからアイコンをクリックする手順">
            </div>
          </li>
          <li class="list-group-item">開いた設定画面のフォームに、コピーしたトークンを<strong>貼り付け</strong>て保存します。
            <div class="mt-3 text-center">
              <img src="/images/step3_token_form.jpg" class="img-fluid border rounded shadow-sm" alt="拡張機能の設定フォームにトークンを貼り付ける手順">
            </div>
          </li>
          <li class="list-group-item">拡張機能が有効になり、<strong>YouTubeで動画を視聴するたびに視聴回数が自動で記録</strong>されます！</li>
        </ol>
        <p class="mt-4 text-muted">※ もしうまく動かない場合は、Chrome拡張機能の設定画面でトークンを再確認するか、このページでトークンを再生成してください。</p>
      </div>
    </div>
  </div>

  <div class="mt-5 text-center">
    <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete }, class: "btn btn-secondary btn-lg" %>
  </div>
</div>