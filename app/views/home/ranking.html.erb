<div class="container mt-5">
  <!-- 検索バーそのまま -->
  <div class="row justify-content-center mb-4">
    <div class="col-md-6">
      <%= form_with url: search_path, method: :get, local: true do |f| %>
        <div class="input-group">
          <%= f.text_field :q, class: "form-control", placeholder: "動画を検索..." %>
          <button class="btn btn-primary" type="submit">検索</button>
        </div>
      <% end %>
    </div>
  </div>

  <!-- ここがポイント！data-turbo="false" をタブ全体の直前にだけ付ける -->
  <div data-turbo="false">
    <ul class="nav nav-tabs justify-content-center mb-4" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="my-tab" data-bs-toggle="tab" href="#my" role="tab" aria-selected="true">自分ランキング</a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="all-tab" data-bs-toggle="tab" href="#all" role="tab" aria-selected="false">全体ランキング</a>
      </li>
    </ul>

    <div class="tab-content">
      <!-- 自分ランキング -->
      <div class="tab-pane fade show active" id="my" role="tabpanel" aria-labelledby="my-tab">
        <% if user_signed_in? && @my_rankings.present? %>
          <% @my_rankings.each_with_index do |video, index| %>
            <% my_count = video.posts.where(user: current_user).count %>
            <p class="mb-2">
              <strong><%= index + 1 %>.</strong> <%= video.title %>
              <span class="text-primary">（あなたは <%= my_count %>回視聴）</span>
            </p>
          <% end %>
        <% elsif user_signed_in? %>
          <p class="text-muted text-center">まだ視聴履歴がありません…</p>
        <% else %>
          <p class="text-center">ログインすると自分のランキングが見れます！</p>
        <% end %>
      </div>

      <!-- 全体ランキング -->
      <div class="tab-pane fade" id="all" role="tabpanel" aria-labelledby="all-tab">
        <% @all_rankings.each_with_index do |video, index| %>
          <p class="mb-2">
            <strong><%= index + 1 %>.</strong> <%= video.title %>
            <span class="text-success">（みんなで <%= video.posts.count %>回視聴）</span>
          </p>
        <% end %>
      </div>
    </div>
  </div>
</div>